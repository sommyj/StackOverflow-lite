'use strict';var cov_ql1ilge0b=function(){var path="/home/somto/1Projects/mentorship project/StackOverflow-lite/server/server/controllers/utilities/errorHandler.js",hash="607c5803e0386a27ce3f630908f64268acb37c5d",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/home/somto/1Projects/mentorship project/StackOverflow-lite/server/server/controllers/utilities/errorHandler.js",statementMap:{"0":{start:{line:3,column:0},end:{line:5,column:3}},"1":{start:{line:7,column:18},end:{line:7,column:58}},"2":{start:{line:9,column:19},end:{line:9,column:54}},"3":{start:{line:11,column:23},end:{line:11,column:51}},"4":{start:{line:13,column:24},end:{line:13,column:64}},"5":{start:{line:15,column:39},end:{line:15,column:93}},"6":{start:{line:17,column:11},end:{line:17,column:44}},"7":{start:{line:18,column:17},end:{line:18,column:24}},"8":{start:{line:20,column:12},end:{line:20,column:62}},"9":{start:{line:21,column:29},end:{line:21,column:37}},"10":{start:{line:25,column:15},end:{line:27,column:1}},"11":{start:{line:26,column:2},end:{line:26,column:38}},"12":{start:{line:29,column:14},end:{line:31,column:1}},"13":{start:{line:30,column:2},end:{line:30,column:40}},"14":{start:{line:33,column:19},end:{line:77,column:1}},"15":{start:{line:36,column:4},end:{line:36,column:51}},"16":{start:{line:36,column:18},end:{line:36,column:51}},"17":{start:{line:37,column:4},end:{line:37,column:39}},"18":{start:{line:41,column:4},end:{line:41,column:71}},"19":{start:{line:44,column:4},end:{line:44,column:65}},"20":{start:{line:48,column:4},end:{line:48,column:67}},"21":{start:{line:51,column:4},end:{line:51,column:72}},"22":{start:{line:54,column:4},end:{line:54,column:69}},"23":{start:{line:57,column:4},end:{line:57,column:69}},"24":{start:{line:60,column:4},end:{line:60,column:72}},"25":{start:{line:63,column:4},end:{line:63,column:51}},"26":{start:{line:63,column:18},end:{line:63,column:51}},"27":{start:{line:64,column:4},end:{line:64,column:88}},"28":{start:{line:67,column:4},end:{line:67,column:80}},"29":{start:{line:70,column:4},end:{line:70,column:91}},"30":{start:{line:73,column:4},end:{line:75,column:5}},"31":{start:{line:74,column:6},end:{line:74,column:18}},"32":{start:{line:75,column:5},end:{line:75,column:18}},"33":{start:{line:79,column:0},end:{line:79,column:31}}},fnMap:{"0":{name:"_interopRequireDefault",decl:{start:{line:15,column:9},end:{line:15,column:31}},loc:{start:{line:15,column:37},end:{line:15,column:95}},line:15},"1":{name:"isNumber",decl:{start:{line:25,column:24},end:{line:25,column:32}},loc:{start:{line:25,column:36},end:{line:27,column:1}},line:25},"2":{name:"isFloat",decl:{start:{line:29,column:23},end:{line:29,column:30}},loc:{start:{line:29,column:34},end:{line:31,column:1}},line:29},"3":{name:"createHandlerError",decl:{start:{line:34,column:31},end:{line:34,column:49}},loc:{start:{line:34,column:72},end:{line:38,column:3}},line:34},"4":{name:"notFoundHandlerError",decl:{start:{line:39,column:33},end:{line:39,column:53}},loc:{start:{line:39,column:80},end:{line:42,column:3}},line:39},"5":{name:"incompleteFieldHandlerError",decl:{start:{line:43,column:40},end:{line:43,column:67}},loc:{start:{line:43,column:73},end:{line:45,column:3}},line:43},"6":{name:"fileHandleError",decl:{start:{line:46,column:28},end:{line:46,column:43}},loc:{start:{line:46,column:58},end:{line:49,column:3}},line:46},"7":{name:"usernameHandlerError",decl:{start:{line:50,column:33},end:{line:50,column:53}},loc:{start:{line:50,column:59},end:{line:52,column:3}},line:50},"8":{name:"emailHandlerError",decl:{start:{line:53,column:30},end:{line:53,column:47}},loc:{start:{line:53,column:53},end:{line:55,column:3}},line:53},"9":{name:"phoneHandlerError",decl:{start:{line:56,column:30},end:{line:56,column:47}},loc:{start:{line:56,column:53},end:{line:58,column:3}},line:56},"10":{name:"questionHandlerError",decl:{start:{line:59,column:33},end:{line:59,column:53}},loc:{start:{line:59,column:59},end:{line:61,column:3}},line:59},"11":{name:"userNotPrestentHandlerError",decl:{start:{line:62,column:40},end:{line:62,column:67}},loc:{start:{line:62,column:83},end:{line:65,column:3}},line:62},"12":{name:"noTokenHandlerError",decl:{start:{line:66,column:32},end:{line:66,column:51}},loc:{start:{line:66,column:57},end:{line:68,column:3}},line:66},"13":{name:"failedAuthHandlerError",decl:{start:{line:69,column:35},end:{line:69,column:57}},loc:{start:{line:69,column:63},end:{line:71,column:3}},line:69},"14":{name:"parametersHandlerError",decl:{start:{line:72,column:35},end:{line:72,column:57}},loc:{start:{line:72,column:63},end:{line:76,column:3}},line:72}},branchMap:{"0":{loc:{start:{line:15,column:46},end:{line:15,column:92}},type:"cond-expr",locations:[{start:{line:15,column:70},end:{line:15,column:73}},{start:{line:15,column:76},end:{line:15,column:92}}],line:15},"1":{loc:{start:{line:15,column:46},end:{line:15,column:67}},type:"binary-expr",locations:[{start:{line:15,column:46},end:{line:15,column:49}},{start:{line:15,column:53},end:{line:15,column:67}}],line:15},"2":{loc:{start:{line:30,column:9},end:{line:30,column:39}},type:"binary-expr",locations:[{start:{line:30,column:9},end:{line:30,column:24}},{start:{line:30,column:28},end:{line:30,column:39}}],line:30},"3":{loc:{start:{line:36,column:4},end:{line:36,column:51}},type:"if",locations:[{start:{line:36,column:4},end:{line:36,column:51}},{start:{line:36,column:4},end:{line:36,column:51}}],line:36},"4":{loc:{start:{line:63,column:4},end:{line:63,column:51}},type:"if",locations:[{start:{line:63,column:4},end:{line:63,column:51}},{start:{line:63,column:4},end:{line:63,column:51}}],line:63},"5":{loc:{start:{line:73,column:4},end:{line:75,column:5}},type:"if",locations:[{start:{line:73,column:4},end:{line:75,column:5}},{start:{line:73,column:4},end:{line:75,column:5}}],line:73},"6":{loc:{start:{line:73,column:8},end:{line:73,column:182}},type:"binary-expr",locations:[{start:{line:73,column:8},end:{line:73,column:40}},{start:{line:73,column:44},end:{line:73,column:98}},{start:{line:73,column:102},end:{line:73,column:136}},{start:{line:73,column:140},end:{line:73,column:182}}],line:73}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0,0,0]},_coverageSchema:"d34fc3e6b8297bcde183f5492bcb8fcb36775295"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();cov_ql1ilge0b.s[0]++;Object.defineProperty(exports,"__esModule",{value:true});var _fileSystem=(cov_ql1ilge0b.s[1]++,require('../../../utilities/fileSystem'));var _fileSystem2=(cov_ql1ilge0b.s[2]++,_interopRequireDefault(_fileSystem));var _filebaseStorage=(cov_ql1ilge0b.s[3]++,require('./filebaseStorage'));var _filebaseStorage2=(cov_ql1ilge0b.s[4]++,_interopRequireDefault(_filebaseStorage));function _interopRequireDefault(obj){cov_ql1ilge0b.f[0]++;cov_ql1ilge0b.s[5]++;return(cov_ql1ilge0b.b[1][0]++,obj)&&(cov_ql1ilge0b.b[1][1]++,obj.__esModule)?(cov_ql1ilge0b.b[0][0]++,obj):(cov_ql1ilge0b.b[0][1]++,{default:obj});}var _ref=(cov_ql1ilge0b.s[6]++,[_fileSystem2.default.deleteFile]),deleteFile=(cov_ql1ilge0b.s[7]++,_ref[0]);// Delete file helper method
var _ref2=(cov_ql1ilge0b.s[8]++,[_filebaseStorage2.default.deleteImageFromStorage]),deleteImageFromStorage=(cov_ql1ilge0b.s[9]++,_ref2[0]);// number validation
cov_ql1ilge0b.s[10]++;var isNumber=function isNumber(n){cov_ql1ilge0b.f[1]++;cov_ql1ilge0b.s[11]++;return!Number.isNaN(parseFloat(n));};cov_ql1ilge0b.s[12]++;var isFloat=function isFloat(n){cov_ql1ilge0b.f[2]++;cov_ql1ilge0b.s[13]++;return(cov_ql1ilge0b.b[2][0]++,Number(n)===n)&&(cov_ql1ilge0b.b[2][1]++,n%1!==0);};var errorHandler=(cov_ql1ilge0b.s[14]++,{createHandlerError:function createHandlerError(error,res,fileName){cov_ql1ilge0b.f[3]++;cov_ql1ilge0b.s[15]++;// if (filePath) deleteFile(`./${filePath}`);
if(fileName){cov_ql1ilge0b.b[3][0]++;cov_ql1ilge0b.s[16]++;deleteImageFromStorage(fileName);}else{cov_ql1ilge0b.b[3][1]++;}// if file uploads delete it
cov_ql1ilge0b.s[17]++;return res.status(400).send(error);},notFoundHandlerError:function notFoundHandlerError(fieldName,res,filePath){cov_ql1ilge0b.f[4]++;cov_ql1ilge0b.s[18]++;// if (filePath) deleteFile(`./${filePath}`); // if file uploads delete it
return res.status(404).send({message:fieldName+' not found'});},incompleteFieldHandlerError:function incompleteFieldHandlerError(res){cov_ql1ilge0b.f[5]++;cov_ql1ilge0b.s[19]++;return res.status(206).send({message:'Incomplete field'});},fileHandleError:function fileHandleError(res,message){cov_ql1ilge0b.f[6]++;cov_ql1ilge0b.s[20]++;// file type handleError
return res.status(403).json({message:message,error:true});},usernameHandlerError:function usernameHandlerError(res){cov_ql1ilge0b.f[7]++;cov_ql1ilge0b.s[21]++;return res.status(400).send({message:'username already exists'});},emailHandlerError:function emailHandlerError(res){cov_ql1ilge0b.f[8]++;cov_ql1ilge0b.s[22]++;return res.status(400).send({message:'email already exists'});},phoneHandlerError:function phoneHandlerError(res){cov_ql1ilge0b.f[9]++;cov_ql1ilge0b.s[23]++;return res.status(400).send({message:'phone already exists'});},questionHandlerError:function questionHandlerError(res){cov_ql1ilge0b.f[10]++;cov_ql1ilge0b.s[24]++;return res.status(400).send({message:'question already exists'});},userNotPrestentHandlerError:function userNotPrestentHandlerError(res,fileName){cov_ql1ilge0b.f[11]++;cov_ql1ilge0b.s[25]++;if(fileName){cov_ql1ilge0b.b[4][0]++;cov_ql1ilge0b.s[26]++;deleteImageFromStorage(fileName);}else{cov_ql1ilge0b.b[4][1]++;}// if file uploads delete it
cov_ql1ilge0b.s[27]++;return res.status(400).send({message:'user has been removed from the database'});},noTokenHandlerError:function noTokenHandlerError(res){cov_ql1ilge0b.f[12]++;cov_ql1ilge0b.s[28]++;return res.status(401).send({auth:false,message:'No token provided.'});},failedAuthHandlerError:function failedAuthHandlerError(res){cov_ql1ilge0b.f[13]++;cov_ql1ilge0b.s[29]++;return res.status(500).send({auth:false,message:'Failed to authenticate token.'});},parametersHandlerError:function parametersHandlerError(req){cov_ql1ilge0b.f[14]++;cov_ql1ilge0b.s[30]++;if((cov_ql1ilge0b.b[6][0]++,!isNumber(req.params.questionId))||(cov_ql1ilge0b.b[6][1]++,!Number.isInteger(parseInt(req.params.questionId,10)))||(cov_ql1ilge0b.b[6][2]++,req.params.questionId>1000000000)||(cov_ql1ilge0b.b[6][3]++,isFloat(parseFloat(req.params.questionId)))){cov_ql1ilge0b.b[5][0]++;cov_ql1ilge0b.s[31]++;return true;}else{cov_ql1ilge0b.b[5][1]++;}cov_ql1ilge0b.s[32]++;return false;}});cov_ql1ilge0b.s[33]++;exports.default=errorHandler;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVycm9ySGFuZGxlci5qcyJdLCJuYW1lcyI6WyJmc0hlbHBlciIsImRlbGV0ZUZpbGUiLCJpbWFnZVN0b3JhZ2UiLCJkZWxldGVJbWFnZUZyb21TdG9yYWdlIiwiaXNOdW1iZXIiLCJOdW1iZXIiLCJpc05hTiIsInBhcnNlRmxvYXQiLCJuIiwiaXNGbG9hdCIsImVycm9ySGFuZGxlciIsImNyZWF0ZUhhbmRsZXJFcnJvciIsImVycm9yIiwicmVzIiwiZmlsZU5hbWUiLCJzdGF0dXMiLCJzZW5kIiwibm90Rm91bmRIYW5kbGVyRXJyb3IiLCJmaWVsZE5hbWUiLCJmaWxlUGF0aCIsIm1lc3NhZ2UiLCJpbmNvbXBsZXRlRmllbGRIYW5kbGVyRXJyb3IiLCJmaWxlSGFuZGxlRXJyb3IiLCJqc29uIiwidXNlcm5hbWVIYW5kbGVyRXJyb3IiLCJlbWFpbEhhbmRsZXJFcnJvciIsInBob25lSGFuZGxlckVycm9yIiwicXVlc3Rpb25IYW5kbGVyRXJyb3IiLCJ1c2VyTm90UHJlc3RlbnRIYW5kbGVyRXJyb3IiLCJub1Rva2VuSGFuZGxlckVycm9yIiwiYXV0aCIsImZhaWxlZEF1dGhIYW5kbGVyRXJyb3IiLCJwYXJhbWV0ZXJzSGFuZGxlckVycm9yIiwicmVxIiwicGFyYW1zIiwicXVlc3Rpb25JZCIsImlzSW50ZWdlciIsInBhcnNlSW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7OztBQUNBOzs7Ozs7V0FFcUIsQ0FBQ0EscUJBQVNDLFVBQVYsQztJQUFkQSxVLFlBQW9DOztZQUNWLENBQUNDLDBCQUFhQyxzQkFBZCxDO0lBQTFCQSxzQjs7QUFFUDs7QUFDQSxJQUFNQyxXQUFXLFNBQVhBLFFBQVc7QUFBQSxTQUFLLENBQUNDLE9BQU9DLEtBQVAsQ0FBYUMsV0FBV0MsQ0FBWCxDQUFiLENBQU47QUFBQSxDQUFqQjs7QUFFQSxJQUFNQyxVQUFVLFNBQVZBLE9BQVU7QUFBQSxTQUFLSixPQUFPRyxDQUFQLE1BQWNBLENBQWQsSUFBbUJBLElBQUksQ0FBSixLQUFV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QyxFQUFoQyxDQUFqQixDQUFyQyxJQUNHRixJQUFJQyxNQUFKLENBQVdDLFVBQVgsR0FBd0IsVUFEM0IsSUFDeUMxQixRQUFRRixXQUFXMEIsSUFBSUMsTUFBSixDQUFXQyxVQUF0QixDQUFSLENBRDdDLEVBQ3lGO0FBQ3ZGLGFBQU8sSUFBUDtBQUNELEtBQUMsT0FBTyxLQUFQO0FBQ0g7QUEzQ2tCLENBQXJCOztrQkE4Q2V6QixZIiwiZmlsZSI6ImVycm9ySGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS9zb210by8xUHJvamVjdHMvbWVudG9yc2hpcCBwcm9qZWN0L1N0YWNrT3ZlcmZsb3ctbGl0ZS9zZXJ2ZXIvc2VydmVyL2NvbnRyb2xsZXJzL3V0aWxpdGllcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmc0hlbHBlciBmcm9tICcuLi8uLi8uLi91dGlsaXRpZXMvZmlsZVN5c3RlbSc7XG5pbXBvcnQgaW1hZ2VTdG9yYWdlIGZyb20gJy4vZmlsZWJhc2VTdG9yYWdlJztcblxuY29uc3QgW2RlbGV0ZUZpbGVdID0gW2ZzSGVscGVyLmRlbGV0ZUZpbGVdOy8vIERlbGV0ZSBmaWxlIGhlbHBlciBtZXRob2RcbmNvbnN0IFtkZWxldGVJbWFnZUZyb21TdG9yYWdlXSA9IFtpbWFnZVN0b3JhZ2UuZGVsZXRlSW1hZ2VGcm9tU3RvcmFnZV07XG5cbi8vIG51bWJlciB2YWxpZGF0aW9uXG5jb25zdCBpc051bWJlciA9IG4gPT4gIU51bWJlci5pc05hTihwYXJzZUZsb2F0KG4pKTtcblxuY29uc3QgaXNGbG9hdCA9IG4gPT4gTnVtYmVyKG4pID09PSBuICYmIG4gJSAxICE9PSAwO1xuXG5jb25zdCBlcnJvckhhbmRsZXIgPSB7XG4gIGNyZWF0ZUhhbmRsZXJFcnJvcihlcnJvciwgcmVzLCBmaWxlTmFtZSkge1xuICAgIC8vIGlmIChmaWxlUGF0aCkgZGVsZXRlRmlsZShgLi8ke2ZpbGVQYXRofWApO1xuICAgIGlmKGZpbGVOYW1lKSBkZWxldGVJbWFnZUZyb21TdG9yYWdlKGZpbGVOYW1lKTsgLy8gaWYgZmlsZSB1cGxvYWRzIGRlbGV0ZSBpdFxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZChlcnJvcik7XG4gIH0sXG4gIG5vdEZvdW5kSGFuZGxlckVycm9yKGZpZWxkTmFtZSwgcmVzLCBmaWxlUGF0aCkge1xuICAgIC8vIGlmIChmaWxlUGF0aCkgZGVsZXRlRmlsZShgLi8ke2ZpbGVQYXRofWApOyAvLyBpZiBmaWxlIHVwbG9hZHMgZGVsZXRlIGl0XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5zZW5kKHsgbWVzc2FnZTogYCR7ZmllbGROYW1lfSBub3QgZm91bmRgIH0pO1xuICB9LFxuICBpbmNvbXBsZXRlRmllbGRIYW5kbGVyRXJyb3IocmVzKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjA2KS5zZW5kKHsgbWVzc2FnZTogJ0luY29tcGxldGUgZmllbGQnIH0pO1xuICB9LFxuICBmaWxlSGFuZGxlRXJyb3IocmVzLCBtZXNzYWdlKSB7IC8vIGZpbGUgdHlwZSBoYW5kbGVFcnJvclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6IG1lc3NhZ2UsIGVycm9yOiB0cnVlIH0pO1xuICB9LFxuICB1c2VybmFtZUhhbmRsZXJFcnJvcihyZXMpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoeyBtZXNzYWdlOiAndXNlcm5hbWUgYWxyZWFkeSBleGlzdHMnIH0pO1xuICB9LFxuICBlbWFpbEhhbmRsZXJFcnJvcihyZXMpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoeyBtZXNzYWdlOiAnZW1haWwgYWxyZWFkeSBleGlzdHMnIH0pO1xuICB9LFxuICBwaG9uZUhhbmRsZXJFcnJvcihyZXMpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoeyBtZXNzYWdlOiAncGhvbmUgYWxyZWFkeSBleGlzdHMnIH0pO1xuICB9LFxuICBxdWVzdGlvbkhhbmRsZXJFcnJvcihyZXMpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoeyBtZXNzYWdlOiAncXVlc3Rpb24gYWxyZWFkeSBleGlzdHMnIH0pO1xuICB9LFxuICB1c2VyTm90UHJlc3RlbnRIYW5kbGVyRXJyb3IocmVzLCBmaWxlTmFtZSkge1xuICAgIGlmKGZpbGVOYW1lKSBkZWxldGVJbWFnZUZyb21TdG9yYWdlKGZpbGVOYW1lKTsgLy8gaWYgZmlsZSB1cGxvYWRzIGRlbGV0ZSBpdFxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZCh7IG1lc3NhZ2U6ICd1c2VyIGhhcyBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgZGF0YWJhc2UnIH0pO1xuICB9LFxuICBub1Rva2VuSGFuZGxlckVycm9yKHJlcykge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuc2VuZCh7IGF1dGg6IGZhbHNlLCBtZXNzYWdlOiAnTm8gdG9rZW4gcHJvdmlkZWQuJyB9KTtcbiAgfSxcbiAgZmFpbGVkQXV0aEhhbmRsZXJFcnJvcihyZXMpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLnNlbmQoeyBhdXRoOiBmYWxzZSwgbWVzc2FnZTogJ0ZhaWxlZCB0byBhdXRoZW50aWNhdGUgdG9rZW4uJyB9KTtcbiAgfSxcbiAgcGFyYW1ldGVyc0hhbmRsZXJFcnJvcihyZXEpIHtcbiAgICBpZiAoIWlzTnVtYmVyKHJlcS5wYXJhbXMucXVlc3Rpb25JZCkgfHwgIU51bWJlci5pc0ludGVnZXIocGFyc2VJbnQocmVxLnBhcmFtcy5xdWVzdGlvbklkLCAxMCkpXG4gICAgICAgIHx8IHJlcS5wYXJhbXMucXVlc3Rpb25JZCA+IDEwMDAwMDAwMDAgfHwgaXNGbG9hdChwYXJzZUZsb2F0KHJlcS5wYXJhbXMucXVlc3Rpb25JZCkpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgZXJyb3JIYW5kbGVyO1xuIl19